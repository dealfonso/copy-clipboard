/* Copyright 2023 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
(function(t){if(typeof t==="undefined"){var t={}}const n="1.0.0";const a={target:null,targetChildren:null,multiple:true,joinText:"\n",images:true,value:null,suppressWarnings:true,debug:false};function i(e){let t=e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("");return t.charAt(0).toLowerCase()+t.slice(1)}function c(t,r={},o=""){if(o!=""){o=o+"-"}let n={};for(const a in r){let e=i(`${o}${a}`);if(e in t.dataset){n[a]=t.dataset[e]}else{n[a]=r[a]}}return n}function u(e){if(!!e===e){return e}if(+e===e){if(e==0)return false;return true}if(""+e===e){return e.toLowerCase()==="true"}return!!e}async function f(e){try{await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy text to clipboard:",e)}}async function p(t){async function r(e,t=false){async function r(o){const n=document.createElement("canvas");const e=n.getContext("2d");n.width=o.naturalWidth||o.width;n.height=o.naturalHeight||o.height;e.drawImage(o,0,0);return new Promise((t,r)=>{n.toBlob(e=>{n.remove();if(a){o.remove()}if(e){t(e)}else{r(new Error("Failed to create blob from canvas"))}},"image/png")})}let o=e;let a=false;if(t){a=true;o=new Image;o.crossOrigin="anonymous";o.src=e.src;return new Promise((e,t)=>{o.onload=()=>r(o).then(e).catch(t);o.onerror=e=>t(new Error(`Failed to load image: ${e.message}`))})}else{return r(o)}}let o=null;try{o=await r(t,false)}catch(e){console.warn("Failed to get image without cross-origin; we'll try to download it again\n",e)}try{if(!o){o=await r(t,true)}if(!o){throw new Error("Blob creation failed")}let e=new ClipboardItem({[o.type]:o});try{await navigator.clipboard.write([e])}catch(e){console.error("Failed to copy image to clipboard:",e)}}catch(e){console.error("Failed to fetch image:",e)}}function r(e,t={}){t=Object.assign({},a,t);let i=e=>e;let l=e=>e;if(!u(t.suppressWarnings)){i=(...e)=>console.warn(...e)}if(u(t.debug)){l=(...e)=>console.log(...e)}let r=[];if(typeof e==="string"){r=document.querySelectorAll(e)}else if(e instanceof HTMLElement){r=[e]}if(r.length===0){i("No elements found to make copyable:",e);return}if(r instanceof NodeList||r instanceof HTMLCollection){r=Array.from(r)}else if(!Array.isArray(r)){r=[r]}for(const s of r){let a=c(s,t,"copy");i=e=>e;if(!u(a.suppressWarnings)){i=e=>console.warn(e)}l=e=>e;if(u(a.debug)){l=(...e)=>console.log(...e)}if(!a.target&&!a.targetChildren&&!a.value){i("Nothing to copy for element:",s);continue}if(s._copyClipboard){s.removeEventListener("click",s._copyClipboard.copyHandler);delete s._copyClipboard}const o=function(){let o=[];if(a.value){if(t.images&&t.value instanceof File&&t.value.type.startsWith("image/")){let e=new ClipboardItem({[t.value.type]:t.value});navigator.clipboard.write([e]).then(()=>{l(`Image copied from file to clipboard.`)}).catch(e=>{console.error("Failed to copy image:",e)});return}else if(typeof t.value==="string"||typeof t.value==="number"){f(t.value);return}else if(t.value instanceof HTMLElement){f(t.value.innerText||t.value.textContent);return}else if(Array.isArray(t.value)){f(t.value.join("\n"));return}else{i(`Unsupported value type for copying: ${typeof t.value}. Expected string, number, HTMLElement or array.`);return}}else{let e=a.target?document.querySelectorAll(a.target):[];let t=a.targetChildren?s.querySelectorAll(a.targetChildren):[];e=[...e,...t];if(e.length===0){i(`No target elements found for selector: ${a.target} or children selector: ${a.targetChildren}.`);return}if(!u(a.multiple)){o=[e[0]];l(`Copying only the first target element: ${o[0]}`)}else{o=Array.from(e);l(`Copying all target elements: `,o)}let r=[];for(const n of o){if(u(a.images)&&n.tagName.toLowerCase()==="img"){p(n);return}else{if(n.tagName.toLowerCase()==="input"||n.tagName.toLowerCase()==="textarea"){r.push(n.value||"")}else if(n.tagName.toLowerCase()==="select"){r.push(n.options[n.selectedIndex].text||"")}else if(n.tagName.toLowerCase()==="img"){r.push(n.alt||n.title||n.src||"")}else{r.push(n.innerText||n.textContent||n.value||n.text||n.alt||"")}}}if(r.length>0){f(r.join(a.joinText))}}};s._copyClipboard={options:a,copyHandler:o,version:n};s.addEventListener("click",o)}}navigator.permissions.query({name:"clipboard-write"}).then(e=>{if(e.state==="granted"||e.state==="prompt"){t.copyClipboard=r}else{console.warn("Clipboard write permission is not granted. Cannot make elements copyable.");t.copyClipboard=function(){console.warn("Clipboard write permission is not granted. Cannot make elements copyable.")}}t.copyClipboard.version=n});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll("[data-copy-target],[data-copy-value],[data-copy-target-children]");e.forEach(e=>{const t=c(e,a,"copy");r(e,t)})})})(window);