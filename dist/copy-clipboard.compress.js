/* Copyright 2023 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
{var t=window;void 0===t&&(t={});let o="1.0.0",a={target:null,targetChildren:null,multiple:!0,joinText:"\n",images:!0,value:null,suppressWarnings:!0,debug:!1};function r(e,t={},o=""){""!=o&&(o+="-");var a,r={};for(a in t){var n=void 0,n=(n=(""+o+a).split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("")).charAt(0).toLowerCase()+n.slice(1);n in e.dataset?r[a]=e.dataset[n]:r[a]=t[a]}return r}function d(e){return!!e===e?e:+e===e?0!=e:""+e===e?"true"===e.toLowerCase():e}async function p(e){try{await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy text to clipboard:",e)}}function n(e,l={}){l=Object.assign({},a,l);let c=e=>e,s=e=>e,t=(d(l.suppressWarnings)||(c=(...e)=>console.warn(...e)),d(l.debug)&&(s=(...e)=>console.log(...e)),[]);if("string"==typeof e?t=document.querySelectorAll(e):e instanceof HTMLElement&&(t=[e]),0===t.length)c("No elements found to make copyable:",e);else{t instanceof NodeList||t instanceof HTMLCollection?t=Array.from(t):Array.isArray(t)||(t=[t]);for(let i of t){let n=r(i,l,"copy"),e;c=e=>e,d(n.suppressWarnings)||(c=e=>console.warn(e)),s=e=>e,d(n.debug)&&(s=(...e)=>console.log(...e)),n.target||n.targetChildren||n.value?(i._copyClipboard&&(i.removeEventListener("click",i._copyClipboard.copyHandler),delete i._copyClipboard),e=function(){let e=[];if(n.value)l.images&&l.value instanceof File&&l.value.type.startsWith("image/")?(t=new ClipboardItem({[l.value.type]:l.value}),navigator.clipboard.write([t]).then(()=>{s("Image copied from file to clipboard.")}).catch(e=>{console.error("Failed to copy image:",e)})):"string"==typeof l.value||"number"==typeof l.value?p(l.value):l.value instanceof HTMLElement?p(l.value.innerText||l.value.textContent):Array.isArray(l.value)?p(l.value.join("\n")):c(`Unsupported value type for copying: ${typeof l.value}. Expected string, number, HTMLElement or array.`);else{var t=n.target?document.querySelectorAll(n.target):[],o=n.targetChildren?i.querySelectorAll(n.targetChildren):[];if(0===(t=[...t,...o]).length)c(`No target elements found for selector: ${n.target} or children selector: ${n.targetChildren}.`);else{d(n.multiple)?(e=Array.from(t),s("Copying all target elements: ",e)):(e=[t[0]],s("Copying only the first target element: "+e[0]));var a,r=[];for(a of e){if(d(n.images)&&"img"===a.tagName.toLowerCase())return void(async e=>{async function t(e,t=!1){async function o(a){let r=document.createElement("canvas"),e=r.getContext("2d");return r.width=a.naturalWidth||a.width,r.height=a.naturalHeight||a.height,e.drawImage(a,0,0),new Promise((t,o)=>{r.toBlob(e=>{r.remove(),n&&a.remove(),e?t(e):o(new Error("Failed to create blob from canvas"))},"image/png")})}let a=e,n=!1;return t?(n=!0,(a=new Image).crossOrigin="anonymous",a.src=e.src,new Promise((e,t)=>{a.onload=()=>o(a).then(e).catch(t),a.onerror=e=>t(new Error("Failed to load image: "+e.message))})):o(a)}let o=null;try{o=await t(e,!1)}catch(e){console.warn("Failed to get image without cross-origin; we'll try to download it again\n",e)}try{if(!(o=o||await t(e,!0)))throw new Error("Blob creation failed");var a=new ClipboardItem({[o.type]:o});try{await navigator.clipboard.write([a])}catch(e){console.error("Failed to copy image to clipboard:",e)}}catch(e){console.error("Failed to fetch image:",e)}})(a);"input"===a.tagName.toLowerCase()||"textarea"===a.tagName.toLowerCase()?r.push(a.value||""):"select"===a.tagName.toLowerCase()?r.push(a.options[a.selectedIndex].text||""):"img"===a.tagName.toLowerCase()?r.push(a.alt||a.title||a.src||""):r.push(a.innerText||a.textContent||a.value||a.text||a.alt||"")}0<r.length&&p(r.join(n.joinText))}}},i._copyClipboard={options:n,copyHandler:e,version:o},i.addEventListener("click",e)):c("Nothing to copy for element:",i)}}}navigator.permissions.query({name:"clipboard-write"}).then(e=>{"granted"===e.state||"prompt"===e.state?t.copyClipboard=n:(console.warn("Clipboard write permission is not granted. Cannot make elements copyable."),t.copyClipboard=function(){console.warn("Clipboard write permission is not granted. Cannot make elements copyable.")}),t.copyClipboard.version=o}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-copy-target],[data-copy-value],[data-copy-target-children]").forEach(e=>{n(e,r(e,a,"copy"))})})}